<UserControl x:Class="SmartFactory.Presentation.Controls.FloorPlan.EquipmentIcon"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             Width="80" Height="80"
             Cursor="Hand">

    <UserControl.Resources>
        <Style x:Key="StatusPulseStyle" TargetType="Ellipse">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPulsing, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                    <DataTrigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard RepeatBehavior="Forever">
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="1" To="0.3" Duration="0:0:0.8"
                                                 AutoReverse="True"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <!-- Selection highlight -->
        <Border x:Name="SelectionBorder"
                BorderThickness="2"
                CornerRadius="8"
                Visibility="Collapsed"
                BorderBrush="{DynamicResource MahApps.Brushes.Accent}"/>

        <!-- Status glow effect -->
        <Ellipse x:Name="StatusGlow"
                 Width="70" Height="70"
                 Opacity="0.3"
                 Fill="{Binding StatusColor, RelativeSource={RelativeSource AncestorType=UserControl}}"
                 Style="{StaticResource StatusPulseStyle}">
            <Ellipse.Effect>
                <BlurEffect Radius="15"/>
            </Ellipse.Effect>
        </Ellipse>

        <!-- Main equipment card -->
        <Border Background="{DynamicResource MahApps.Brushes.Gray8}"
                BorderThickness="1"
                CornerRadius="6"
                Margin="5">
            <Border.BorderBrush>
                <SolidColorBrush Color="{Binding StatusColorValue, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
            </Border.BorderBrush>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Equipment icon -->
                <Viewbox Grid.Row="0" Margin="8,8,8,4">
                    <iconPacks:PackIconMaterial x:Name="EquipmentTypeIcon"
                                                Kind="{Binding IconKind, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                Width="30" Height="30"
                                                Foreground="{Binding StatusColor, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                </Viewbox>

                <!-- Equipment name -->
                <TextBlock Grid.Row="1"
                           Text="{Binding EquipmentName, RelativeSource={RelativeSource AncestorType=UserControl}}"
                           FontSize="9"
                           FontWeight="SemiBold"
                           TextAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"
                           Margin="2,0,2,4"/>
            </Grid>
        </Border>

        <!-- Status indicator dot -->
        <Ellipse Width="12" Height="12"
                 HorizontalAlignment="Right"
                 VerticalAlignment="Top"
                 Margin="0,2,2,0"
                 Stroke="{DynamicResource MahApps.Brushes.Gray8}"
                 StrokeThickness="2"
                 Fill="{Binding StatusColor, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
    </Grid>

    <!-- Tooltip with sensor data -->
    <UserControl.ToolTip>
        <Border Background="{DynamicResource MahApps.Brushes.Gray10}"
                BorderBrush="{DynamicResource MahApps.Brushes.Accent}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12">
            <StackPanel MinWidth="180">
                <TextBlock Text="{Binding EquipmentName, RelativeSource={RelativeSource AncestorType=UserControl}}"
                           FontSize="14" FontWeight="Bold"
                           Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"
                           Margin="0,0,0,8"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Status:" Foreground="{DynamicResource MahApps.Brushes.Gray3}" Margin="0,0,12,4"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding StatusText, RelativeSource={RelativeSource AncestorType=UserControl}}"
                               Foreground="{Binding StatusColor, RelativeSource={RelativeSource AncestorType=UserControl}}" FontWeight="SemiBold"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Temperature:" Foreground="{DynamicResource MahApps.Brushes.Gray3}" Margin="0,0,12,4"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Temperature, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat={}{0:F1}Â°C}"
                               Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Vibration:" Foreground="{DynamicResource MahApps.Brushes.Gray3}" Margin="0,0,12,4"/>
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Vibration, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat={}{0:F2} mm/s}"
                               Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Pressure:" Foreground="{DynamicResource MahApps.Brushes.Gray3}" Margin="0,0,12,4"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Pressure, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat={}{0:F1} PSI}"
                               Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Health:" Foreground="{DynamicResource MahApps.Brushes.Gray3}" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding HealthScore, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat={}{0:F0}%}"
                               Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}" FontWeight="SemiBold"/>
                </Grid>
            </StackPanel>
        </Border>
    </UserControl.ToolTip>
</UserControl>
